<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>zabbix on Almighty.YanTao</title>
    <link>/tags/zabbix/</link>
    <description>Recent content in zabbix on Almighty.YanTao</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 06 Jul 2023 00:00:00 +0800</lastBuildDate><atom:link href="/tags/zabbix/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>制作一个内部的 zabbix 监控 Agent</title>
      <link>/2023/07/06/%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E5%86%85%E9%83%A8%E7%9A%84-zabbix-%E7%9B%91%E6%8E%A7-agent.html/</link>
      <pubDate>Thu, 06 Jul 2023 00:00:00 +0800</pubDate>
      
      <guid>/2023/07/06/%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E5%86%85%E9%83%A8%E7%9A%84-zabbix-%E7%9B%91%E6%8E%A7-agent.html/</guid>
      <description>下载官方的基础 agent 部署包 官方地址：点击到达 1 curl -O https://cdn.zabbix.com/zabbix/binaries/stable/5.0/5.0.36/zabbix_agent-5.0.36-linux-3.0-i386-static.tar.gz 编写 install 脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 #!</description>
    </item>
    
    <item>
      <title>linux通过SNMP检测TCP&amp;UDP连接数</title>
      <link>/2023/03/11/linux%E9%80%9A%E8%BF%87snmp%E6%A3%80%E6%B5%8Btcpudp%E8%BF%9E%E6%8E%A5%E6%95%B0.html/</link>
      <pubDate>Sat, 11 Mar 2023 00:00:00 +0800</pubDate>
      
      <guid>/2023/03/11/linux%E9%80%9A%E8%BF%87snmp%E6%A3%80%E6%B5%8Btcpudp%E8%BF%9E%E6%8E%A5%E6%95%B0.html/</guid>
      <description>先上图&amp;amp;介绍 记录一次全球化网络监控的看板建设； 之前都是通过zabbix来进行建设看板，但是用了一段时间后总是缺点感觉；后面通过大佬的介绍，试用了Grafana，这不试用还好，一试用，效果的展现让我无法自拔，这就是我想要的监控看板啊！能根据数值的不同进行颜色的区分，在大屏上一眼就可以看出当前哪一块网络出现了问题！
美中不足的是，上面的两列不能设置报警，报警貌似必须是图表形式的才可以；不过可以建立一个通用的报警看板，问题不大～
其他的一些监控项都是最简单基础的，我这边就不过多的赘述，大家可以自行上网搜索，或者之前引用之前zabbix的数据，主要讲解下TCP连接数和UDP连接数的获取
别的不说，这图还是很好看的； 准备 SNMP 自定义OID snmp安装 1 2 3 yum install net-snmp systemctl start snmpd systemctl enable snmpd 修改配置文件 1 2 3 4 5 6 7 8 # 修改团体名 com2sec notConfigUser default xxxxx # view systemview included .1.3.6.1.2.1. （这两行注释） # view systemview included .1.3.6.1.2.1.25.1.1 # 这两行新增，表示可以查看所有的信息，要不然只能查看上面那两个指定的信息 view all included . view systemview included .1 创建获取连接数脚本 1 2 3 4 #!/bin/bash echo $2 echo integer echo $(netstat -an|awk &amp;#39;/^tcp/ {++s[$NF]} END {for(a in s ) print a,s[a]}&amp;#39; | grep ESTABLISHED | awk &amp;#39;{print $2}&amp;#39;) 这个是获取TCP连接数的脚本，如果要获取UDP的，请把tcp改成udp 设置脚本权限</description>
    </item>
    
    <item>
      <title>curl 检测代理的可用性以及延迟</title>
      <link>/2023/02/20/curl-%E6%A3%80%E6%B5%8B%E4%BB%A3%E7%90%86%E7%9A%84%E5%8F%AF%E7%94%A8%E6%80%A7%E4%BB%A5%E5%8F%8A%E5%BB%B6%E8%BF%9F.html/</link>
      <pubDate>Mon, 20 Feb 2023 00:00:00 +0800</pubDate>
      
      <guid>/2023/02/20/curl-%E6%A3%80%E6%B5%8B%E4%BB%A3%E7%90%86%E7%9A%84%E5%8F%AF%E7%94%A8%E6%80%A7%E4%BB%A5%E5%8F%8A%E5%BB%B6%E8%BF%9F.html/</guid>
      <description>背景 在办公网的代理翻墙的过程中，经常没办法第一时间知道代理失效了，因为我们自身不是高用的用户，每次挂了都需要员工来反馈，体感非常的不好，因此想着可以通过zabbix如果把当前的延迟、可用性检测起来
通过Curl 检测Google的延迟 这里为啥是curl而不是ping，因为默认ping事不支持代理的，然而curl也可以做到真正的是否可用
1 curl -o /dev/null -x socks5h://127.0.0.1:12126 -s --connect-timeout 5 -w %{time_starttransfer}&amp;#34;\n&amp;#34; $1 socks5h的地址需要改成你的代理地址
1 2 3 4 5 6 7 8 9 10 # 获取当前代理的可用性 ```bash url=$1 result=($(curl -x socks5h://localhost:12126 -I -s --connect-timeout 5 ${url} | head -1 | tr &amp;#34;\r&amp;#34; &amp;#34;\n&amp;#34;)) if [ &amp;#34;${result[1]}&amp;#34; == $2 -a &amp;#34;${result[2]}&amp;#34; == &amp;#39;OK&amp;#39; ] then echo 1 else echo 0 fi zabbix操作脚本 1 2 3 4 5 # 延迟 UserParameter=googleTime[*],/etc/zabbix/script/googleTime.</description>
    </item>
    
    <item>
      <title>zabbix 警报推送至企业微信（图文版）</title>
      <link>/2023/02/05/zabbix-%E8%AD%A6%E6%8A%A5%E6%8E%A8%E9%80%81%E8%87%B3%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E5%9B%BE%E6%96%87%E7%89%88.html/</link>
      <pubDate>Sun, 05 Feb 2023 00:00:00 +0800</pubDate>
      
      <guid>/2023/02/05/zabbix-%E8%AD%A6%E6%8A%A5%E6%8E%A8%E9%80%81%E8%87%B3%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E5%9B%BE%E6%96%87%E7%89%88.html/</guid>
      <description>新增Python脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 # encoding: utf-8 import sys import requests import json import os import time import re url = &amp;#39;http://xx.</description>
    </item>
    
  </channel>
</rss>
