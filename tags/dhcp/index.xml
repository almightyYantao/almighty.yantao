<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>dhcp on Almighty.YanTao</title>
    <link>/tags/dhcp/</link>
    <description>Recent content in dhcp on Almighty.YanTao</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 16 Feb 2023 00:00:00 +0800</lastBuildDate><atom:link href="/tags/dhcp/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>清理自定义DHCP下发，异常断开导致IP地址占用的问题</title>
      <link>/2023/02/16/%E6%B8%85%E7%90%86%E8%87%AA%E5%AE%9A%E4%B9%89dhcp%E4%B8%8B%E5%8F%91%E5%BC%82%E5%B8%B8%E6%96%AD%E5%BC%80%E5%AF%BC%E8%87%B4ip%E5%9C%B0%E5%9D%80%E5%8D%A0%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98.html/</link>
      <pubDate>Thu, 16 Feb 2023 00:00:00 +0800</pubDate>
      
      <guid>/2023/02/16/%E6%B8%85%E7%90%86%E8%87%AA%E5%AE%9A%E4%B9%89dhcp%E4%B8%8B%E5%8F%91%E5%BC%82%E5%B8%B8%E6%96%AD%E5%BC%80%E5%AF%BC%E8%87%B4ip%E5%9C%B0%E5%9D%80%E5%8D%A0%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98.html/</guid>
      <description>背景 因为OpenVpn存在断开重连的机制，如果突然出现网络抖动，用户端没有触发断开命令，但是同时又触发了重新连接的命令，这时候VPN这里就会重新给下发一个新的地址，但是老的地址不会回收掉，这个也是很早之前DHCP被用完的真正原因
处理方式 在每一台openvpn的机器上新增一个shell脚本做定时任务，每天临晨2点开始循环遍历
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 #!/bin/bash IFS=$&amp;#39;\n&amp;#39; # 修改默认分隔符 OLDIFS=&amp;#34;$IFS&amp;#34; # 清理无效的IP地址 function clearIp(){ # 取出当前已经分配下去的所有IP地址 result=$(curl -s &amp;#34;后端获取当前使用IP的接口地址&amp;#34;); ipList=`echo $result | jq &amp;#39;.</description>
    </item>
    
  </channel>
</rss>
