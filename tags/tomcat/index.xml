<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>tomcat on Almighty.YanTao</title>
    <link>/tags/tomcat/</link>
    <description>Recent content in tomcat on Almighty.YanTao</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 18 May 2023 00:00:00 +0800</lastBuildDate><atom:link href="/tags/tomcat/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>解决Nginx SSL 代理 Tomcat 获取 Scheme 总是 Http 问题</title>
      <link>/2023/05/18/%E8%A7%A3%E5%86%B3nginx-ssl-%E4%BB%A3%E7%90%86-tomcat-%E8%8E%B7%E5%8F%96-scheme-%E6%80%BB%E6%98%AF-http-%E9%97%AE%E9%A2%98.html/</link>
      <pubDate>Thu, 18 May 2023 00:00:00 +0800</pubDate>
      
      <guid>/2023/05/18/%E8%A7%A3%E5%86%B3nginx-ssl-%E4%BB%A3%E7%90%86-tomcat-%E8%8E%B7%E5%8F%96-scheme-%E6%80%BB%E6%98%AF-http-%E9%97%AE%E9%A2%98.html/</guid>
      <description>背景 公司之前用的是http，但是出于苹果app审核和服务器安全性问题，要改为https，我们公司用的是沃通的ssl，按照沃通的官方文档提供的步骤完成服务器的配置。 架构上使用了 Nginx +tomcat 集群, 且nginx下配置了SSL,tomcat 没有配置SSL,项目使用https协议。
原因 配置成功后明明是https url请求,发现 log里面，tomcat获取scheme的时候，一直是http，而不是想像中的https
1 2 3 4 5 6 7 8 0415 16:01:10 INFO (PaymentInterceptor.java:44) preHandle() - requestStringForLog: { &amp;#34;request.getRequestURL():&amp;#34;: &amp;#34;http://m.xxx.com/payment/paymentChannel?id=212&amp;amp;s=a84485e0985afe97fffd7fd7741c93851d83a4f6&amp;#34;, &amp;#34;request.getMethod:&amp;#34;: &amp;#34;GET&amp;#34;, &amp;#34;_parameterMap&amp;#34;: { &amp;#34;id&amp;#34;: [&amp;#34;212&amp;#34;], &amp;#34;s&amp;#34;: [&amp;#34;a84485e0985afe97fffd7fd7741c93851d83a4f6&amp;#34;] } } request.getRequestURL() 输出出来的 一直是
http://m.xxx.com/payment/paymentChannel?id=212&amp;s=a84485e0985afe97fffd7fd7741c93851d83a4f6 但是浏览器中的URL却是
https://m.xxx.com/payment/paymentChannel?id=212&amp;s=a84485e0985afe97fffd7fd7741c93851d83a4f6 下面我们进一步研究发现，java API上写得很清楚:
1 2 3 4 5 getRequestURL(): Reconstructs the URL the client used to make the request. The returned URL contains a protocol, server name, port number, and server path, but it does not include query string parameters.</description>
    </item>
    
  </channel>
</rss>
